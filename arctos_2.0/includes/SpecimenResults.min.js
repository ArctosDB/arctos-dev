var map,bounds,markers=[];
function fetchSrchWgtVocab(a,b){var c,e;$("#voccell_"+a).html('<img src="/images/indicator.gif">');jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getVocabulary",key:a,scope:b,returnformat:"json",queryformat:"column"},function(b){if(0===b.DATA.V.length)c="no suggestions found";else{c='<select id="svc_'+a+'" class="ssw_sngselect" onchange="$(\'#'+a+"').val(this.value);\">";c+='<option value=""></option>';for(e=0;e<b.ROWCOUNT;++e)c+='<option value="'+b.DATA.V[e],1<b.DATA.M[e]&&(c+='" class="usedValue"'),
c+='">'+b.DATA.V[e]+"</option>";c+="</select>"}$("#voccell_"+a).html(c)})}
function initializeMap(){$("#spresmapdiv").html("");new google.maps.InfoWindow;var a={zoom:3,center:new google.maps.LatLng(55,-135),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,scaleControl:!0};map=new google.maps.Map(document.getElementById("spresmapdiv"),a);a=$("#cfgml").val();if(0==a.length)return!1;a=a.split(";");for(var b=0;b<a.length;b++)createMarker(a[b]);a=new google.maps.LatLngBounds;for(b=0;b<markers.length;b++)a.extend(markers[b].getPosition());if(a.getNorthEast().equals(a.getSouthWest())){b=
new google.maps.LatLng(a.getNorthEast().lat()+.05,a.getNorthEast().lng()+.05);var c=new google.maps.LatLng(a.getNorthEast().lat()-.05,a.getNorthEast().lng()-.05);a.extend(b);a.extend(c)}map.fitBounds(a)}
function createMarker(a){var b=a.split(",");a=b[0];var c=b[1],e=b[2];b=b[3];var d=new google.maps.LatLng(c,e),f={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.15,map:map,center:d,radius:parseInt(b),zIndex:-99};c=a+" specimens; Error(m)="+b+'<br><span class="likeLink" onclick="addCoordinates(\''+c+","+e+"');\">add point to search</span>"+('<br><a target="_blank" href="/SpecimenResults.cfm?coordinates='+c+","+e+'">specimens @ coordinates (new window)</a>');crcl=
new google.maps.Circle(f);var g=new google.maps.Marker({position:d,map:map,title:a+" specimens; Error(m)="+b,contentString:c,zIndex:10});markers.push(g);var h=new google.maps.InfoWindow({content:c});google.maps.event.addListener(g,"click",function(){h.open(map,g)})}function confirmAddAllDL(){if(1==confirm("Are you sure you want to add all these specimens to the data loan?"))document.location="/Loan.cfm?action=addAllDataLoanItems&transaction_id="+$("#transaction_id").val();else return!1}
function confirmAddAllPartLoan(){var a=$("#loan_all_part_name").val();if(1==confirm("Are you sure you want to add all found "+a+" to the loan, and change their disposition to `on loan`?"))document.location="/Loan.cfm?action=addAllSrchResultLoanItems&transaction_id="+$("#transaction_id").val()+"&part_name="+encodeURIComponent(a);else return!1}
function confirmAddAllPartLoanSS(){var a=$("#loan_all_part_name").val();if(1==confirm("Are you sure you want create subsample of all found "+a+" and add them to the loan? New part disposition will be `on loan`."))document.location="/Loan.cfm?action=SS_addAllSrchResultLoanItems&transaction_id="+$("#transaction_id").val()+"&part_name="+encodeURIComponent(a);else return!1}
$(document).ready(function(){if(-1<window.location.href.indexOf("/m/"))return!1;jQuery("#cntr_refineSearchTerms").html("<img src='/images/indicator.gif'>");jQuery.get("/component/SpecimenResults.cfc?method=get_specSrchTermWidget&returnformat=plain",function(a){jQuery("#cntr_refineSearchTerms").html(a)});initializeMap();$("#srmapctrls-nomap").click(function(){resizeMap("smallmap")});$("#usertools").change(function(){"BerkeleyMapper"==this.value?window.open("/bnhmMaps/bnhmMapData.cfm?"+$("#mapURL").val(),
"_blank"):"BerkeleyMapperRM"==this.value?window.open("/bnhmMaps/bnhmMapData.cfm?showRangeMaps=true&"+$("#mapURL").val(),"_blank"):"google"==this.value&&window.open("/bnhmMaps/kml.cfm","_blank")})});
function toggleSearchTerms(){var a=$("#refineSearchTerms").is(":visible")?0:1;jQuery.getJSON("/component/functions.cfc",{method:"setResultsBrowsePrefs",val:a,returnformat:"json",queryformat:"column"},function(){1==a?(jQuery("#cntr_refineSearchTerms").html("<img src='/images/indicator.gif'>"),jQuery.get("/component/SpecimenResults.cfc?method=get_specSrchTermWidget&returnformat=plain",function(a){jQuery("#cntr_refineSearchTerms").html(a)})):($("#refineSearchTerms").remove(),$("#aboutSTWH").remove(),
$("#fbSWT").remove())})}function openWindow(a){-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")?window.location.href=a:window.open(a,"_blank")}
function pickedTool(){var a=$("#usertools").val();"BerkeleyMapper"==a?openWindow("/bnhmMaps/bnhmMapData.cfm?"+$("#mapURL").val()):"BerkeleyMapperRM"==a?openWindow("/bnhmMaps/bnhmMapData.cfm?showRangeMaps=true&"+$("#mapURL").val()):"google"==a?openWindow("/bnhmMaps/kml.cfm"):"customize"==a?openCustomize():"removeRows"==a?removeRows():"saveSearch"==a?saveSearch($("#ServerRootUrl").val()+"/SpecimenResults.cfm?"+$("#mapURL").val()):"archiveSpecimens"==a?archiveSpecimens():"download"==a&&openWindow("/SpecimenResultsDownload.cfm?tableName="+
$("#SpecSrchTab").val());$("#usertools").val("")}
function openCustomize(){$("<div class='popupDialog'><img src='/images/indicator.gif'></div>").dialog({autoOpen:!0,closeOnEscape:!0,height:"auto",modal:!0,position:["center","center"],title:"Customize results and downloads. Excessive options adversely affect performance.",width:"auto",buttons:{"Save and refresh":function(){closeCustom()}}}).load("/info/SpecimenResultsPrefs.cfm",function(){$(this).dialog("option","position",["center","center"])});$(window).resize(function(){$(".ui-dialog-content").dialog("option","position",
["center","center"])})}function resizeMap(a){"nomap"==a?($("#srmapctrls-nomap").show(),$("#srmapctrls").hide(),$("#spresmapdiv").hide()):($("#srmapctrls-nomap").hide(),$("#srmapctrls").show(),$("#spresmapdiv").show(),$("#spresmapdiv").removeClass().addClass(a),initializeMap());jQuery.getJSON("/component/functions.cfc",{method:"changeUserPreference",pref:"srmapclass",val:a,returnformat:"json",queryformat:"column"})}
$("#customizeButton").live("click",function(a){$("<div class='popupDialog'><img src='/images/indicator.gif'></div>").dialog({autoOpen:!0,closeOnEscape:!0,height:"auto",modal:!0,position:["center","center"],title:"Customize results and downloads. Excessive options adversely affect performance.",width:"auto",buttons:{"Save and refresh":function(){closeCustom()}}}).load("/info/SpecimenResultsPrefs.cfm",function(){$(this).dialog("option","position",["center","center"])});$(window).resize(function(){$(".ui-dialog-content").dialog("option",
"position",["center","center"])})});function closeCustom(){var a="/SpecimenResults.cfm?"+$("#mapURL").val();window.location=a}function getPostLoadJunk(){var a=[];$("div[id^='CatItem_']").each(function(){var b=this.id.split("_")[1];a.push(b)});var b=a.toString();insertMedia(b);insertTypes(b);insertEvtCt(b);injectLoanPick();displayMedia();formatPartDetail();formatJSONLocality()}
function unexpPartDet(){$("div[id^='partdetail_']").each(function(){$(this).removeClass("noshrink")});$("#pdcb").remove();$("#ssControl").append('<input type="button" id="pdcb" value="Expand Part Detail" class="clrBtn" onclick="expPartDet()">')}function unexpLocDet(){$("div[id^='jsonlocality_']").each(function(){$(this).removeClass("noshrink")});$("#ldcb").remove();$("#ssControl").append('<input type="button" id="ldcb" value="Expand JSON Locality" class="clrBtn" onclick="expLocDet()">')}
function expLocDet(){$("div[id^='jsonlocality_']").each(function(){$(this).addClass("noshrink")});$("#ldcb").remove();$("#ssControl").append('<input type="button" id="ldcb" value="Collapse JSON Locality" class="clrBtn" onclick="unexpLocDet()">')}function expPartDet(){$("div[id^='partdetail_']").each(function(){$(this).addClass("noshrink")});$("#pdcb").remove();$("#ssControl").append('<input type="button" id="pdcb" value="Collapse Part Detail" class="clrBtn" onclick="unexpPartDet()">')}
function formatJSONLocality(){$("#ldcb").remove();$('div[id^="jsonlocality_"]').length&&($("div[id^='jsonlocality_']").each(function(){var a=$.parseJSON($("#"+this.id).html());a=JSON.stringify(a,null,2);$("#"+this.id).html("<pre>"+a+"</pre>")}),$("#ssControl").append('<input type="button" id="ldcb" value="Expand JSON Locality" class="clrBtn" onclick="expLocDet()">'))}
function formatPartDetail(){$("#pdcb").remove();$('div[id^="partdetail_"]').length&&($("div[id^='partdetail_']").each(function(){var a=$.parseJSON($("#"+this.id).html());a=JSON.stringify(a,null,2);$("#"+this.id).html("<pre>"+a+"</pre>")}),$("#ssControl").append('<input type="button" id="pdcb" value="Expand Part Detail" class="clrBtn" onclick="expPartDet()">'))}
function displayMedia(a){$("div[id^='jsonmedia_']").each(function(){var a=$.parseJSON($("#"+this.id).html());if(0<a.length)var c='<div class="shortThumb"><div class="thumb_spcr">&nbsp;</div>';jQuery.each(a,function(a,b){"audio"==b.MIMECAT&&"mp3"==b.MEDIA_URI.split(".").pop()?(c+='<div class="one_thumb">',c+="<audio controls>",c+='<source src="'+b.MEDIA_ID+'" type="audio/mp3">',c+='<a href="/media/'+b.MEDIA_ID+'?open" target="_blank">download</a>',c+="</audio> ",c+='<br><a target="_blank" href="/media/'+
b.MEDIA_ID[i]+'">Media Detail</a></p></div>'):$.ajax({url:"/component/functions.cfc?method=getMediaPreview&preview_uri="+b.PREVIEW_URI+"&media_type="+b.MIMECAT+"&returnformat=json&queryformat=column",dataType:"json",async:!1,success:function(a){c+='<div class="one_thumb">';c+='<a href="/media/'+b.MEDIA_ID+'?open" target="_blank">';c+='<img src="'+a+'" class="theThumb"></a>';c+="<p>"+b.MIMECAT+" ("+b.MIME_TYPE+")";c+='<br><a target="_blank" href="/media/'+b.MEDIA_ID+'">Media Detail</a></p></div>'}})});
0<a.length?(c+='<div class="thumb_spcr">&nbsp;</div></div>',$("#"+this.id).html(c)):$("#"+this.id).html("")})}
function insertMedia(a){var b=document.createElement("DIV");b.id="ajaxStatus";b.className="ajaxStatus";b.innerHTML="Checking for Media...";document.body.appendChild(b);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getMedia",idList:a,returnformat:"json",queryformat:"column"},function(a){try{var b=document.getElementById("ajaxStatus");b.innerHTML="Processing Media....";for(i=0;i<a.ROWCOUNT;++i){var c,f=a.DATA.COLLECTION_OBJECT_ID[i],g=a.DATA.MEDIA_ID[i],h=a.DATA.MEDIA_RELATIONSHIP[i];"cataloged_item"==
h?c="CatItem_"+f:"collecting_event"==h&&(c="SpecLocality_"+f);if(0<c.length){var l=document.getElementById(c),k='<a href="/MediaSearch.cfm?action=search&media_id='+g+'" class="mediaLink" target="_blank" id="mediaSpan_'+f+'">';k+="Media";k+="</a>";l.innerHTML+=k}}document.body.removeChild(b)}catch(m){b=document.getElementById("ajaxStatus"),document.body.removeChild(b)}})}
function insertEvtCt(a){var b=document.createElement("DIV");b.id="ajaxStatusE";b.className="ajaxStatus";b.innerHTML="Checking for Events...";document.body.appendChild(b);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getEventCount",idList:a,returnformat:"json",queryformat:"column"},function(a){var b=document.getElementById("ajaxStatusE");try{for(b.innerHTML="Processing Events....",i=0;i<a.ROWCOUNT;++i){var c=a.DATA.NUMEVENTS[i],f="CatItem_"+a.DATA.COLLECTION_OBJECT_ID[i];if(0<f.length){var g=
document.getElementById(f);g.innerHTML+='<div class="showEvtCt">'+c+" Events</div>"}}}catch(h){}document.body.removeChild(b)})}
function insertTypes(a){var b=document.createElement("DIV");b.id="ajaxStatus";b.className="ajaxStatus";b.innerHTML="Checking for Types...";document.body.appendChild(b);jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getTypes",idList:a,returnformat:"json",queryformat:"column"},function(a){var b=document.getElementById("ajaxStatus");try{for(b.innerHTML="Processing Types....",i=0;i<a.ROWCOUNT;++i){var c=a.DATA.TYPELIST[i],f="CatItem_"+a.DATA.COLLECTION_OBJECT_ID[i];if(0<f.length){var g=document.getElementById(f);
g.innerHTML+='<div class="showType">'+c+"</div>"}}}catch(h){}document.body.removeChild(b)})}
function injectLoanPick(){var a=$("#transaction_id").val();a&&"yes"!=$("#isDataLoan").val()&&($("body").append('<div id="ajaxStatus" class="ajaxStatus">Feching Loan Pick...</div>'),jQuery.getJSON("/component/SpecimenResults.cfc",{method:"getLoanPartResults",transaction_id:a,returnformat:"json",queryformat:"column"},function(a){$("div[id^='CatItem_']").each(function(){var b=this.id.split(/_(.+)?/)[1],e=!1,d='<table border width="100%">';for(i=0;i<a.ROWCOUNT;++i)a.DATA.COLLECTION_OBJECT_ID[i]==b&&(e=
!0,d+='<tr><td nowrap="nowrap" class="specResultPartCell"><i>'+a.DATA.PART_NAME[i],0<a.DATA.SAMPLED_FROM_OBJ_ID[i]&&(d+="&nbsp;sample"),d+="&nbsp;("+a.DATA.COLL_OBJ_DISPOSITION[i]+")</i> ["+a.DATA.BARCODE[i]+"]",d+='</td><td nowrap="nowrap" class="specResultPartCell">',d+='Remark:&nbsp;<input type="text" name="item_remark" size="10" id="item_remark_'+a.DATA.PARTID[i]+'">',d+='</td><td nowrap="nowrap" class="specResultPartCell">',d+='Instr.:&nbsp;<input type="text" name="item_instructions" size="10" id="item_instructions_'+
a.DATA.PARTID[i]+'">',d+='</td><td nowrap="nowrap" class="specResultPartCell">',d+='Subsample?:&nbsp;<input type="checkbox" name="subsample" id="subsample_'+a.DATA.PARTID[i]+'">',d+='</td><td nowrap="nowrap" class="specResultPartCell">',d+='<input type="button" id="theButton_'+a.DATA.PARTID[i]+'"',d+=' class="insBtn"',0<a.DATA.TRANSACTION_ID[i]?d+=' onclick="" value="In Loan">':(d+=' value="Add" onclick="addPartToLoan(',d+=a.DATA.PARTID[i]+');">'),null!==a.DATA.ENCUMBRANCE_ACTION[i]&&(d+="<br><i>Encumbrances:&nbsp;"+
a.DATA.ENCUMBRANCE_ACTION[i]+"</i>"),d+="</td></tr>");e&&(d+="</table>",$("#CatItem_"+b).append(d))});$("#ajaxStatus").remove()}))}
function addPartToLoan(a){var b="item_instructions_"+a,c="subsample_"+a,e=document.getElementById("item_remark_"+a).value;b=document.getElementById(b).value;c=document.getElementById(c).checked;c=1==c?1:0;var d=document.getElementById("transaction_id").value;jQuery.getJSON("/component/functions.cfc",{method:"addPartToLoan",transaction_id:d,partID:a,remark:e,instructions:b,subsample:c,returnformat:"json",queryformat:"column"},function(a){a=a.split("|");1==a[0]?(a=document.getElementById("theButton_"+
a[1]),a.value="In Loan",a.onclick=""):alert("An error occured!\n"+a[1])})}function reporter(a){var b=document.getElementById("goWhere").value;if(0==b.length)return alert("Pick a tool, then click the button."),!1;var c=b,e="?";0<b.indexOf("?")&&(e="&");c=c+e+("&table_name="+a)+"&sort=guid";$("#goWhere")[0].selectedIndex=0;window.open(c)}
function removeRows(){var a=$("#specresults").jtable("selectedRows");if(0<a.length){var b=[];a.each(function(){var a=$(this).data("record");b.push(a.COLLECTION_OBJECT_ID)});a="/SpecimenResults.cfm?"+$("#mapURL").val()+"&exclCollObjId="+b.join(",");document.location=a}else alert("select rows, then click")}
function addCoordinates(a){$("#refineSearchTerms").is(":visible")?$("#coordinates").length?$("#coordinates").val(a):jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"coordinates",returnformat:"json",queryformat:"column"},function(b){$("#stermwdgtbl tr:last").after(b);$("#newTerm option[value='coordinates']").remove();$("#coordinates").val(a)}):alert("turn search terms on, then try that")}
function queryByViewport(){if(!$("#refineSearchTerms").is(":visible"))return alert("Turn on the refine widget, then try that click."),!1;var a=map.getBounds(),b=a.getNorthEast().lat(),c=a.getNorthEast().lng(),e=a.getSouthWest().lat(),d=a.getSouthWest().lng();0==$("#nelat").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"nelat",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);$("#newTerm option[value='nelat']").remove();
$("#nelat").val(b)}):$("#nelat").val(b);0==$("#nelong").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"nelong",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);$("#newTerm option[value='nelong']").remove();$("#nelong").val(c)}):$("#nelong").val(c);0==$("#swlat").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"swlat",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);
$("#newTerm option[value='swlat']").remove();$("#swlat").val(e)}):$("#swlat").val(e);0==$("#swlong").length?jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:"swlong",returnformat:"json",queryformat:"column"},function(a){$("#stermwdgtbl tr:last").after(a);$("#newTerm option[value='swlong']").remove();$("#swlong").val(d)}):$("#swlong").val(d)}
function addARow(a){jQuery.getJSON("/component/SpecimenResults.cfc",{method:"specSrchTermWidget_addrow",term:a,returnformat:"json"},function(b){$("#stermwdgtbl tr:last").after(b);$("#newTerm option[value='"+a+"']").remove();$("#ssttble_ctr").scrollTo($("#stermwdgtbl tr:last"),800)})}function removeTerm(a){$("#"+a).remove();$("#row_"+a).remove()}function clearAll(){$("##refineResults").find("input[type=text]").val("")}
function checkMapBB(){if(0<$("#nelat").length&&0<$("#nelong").length&&0<$("#swlat").length&&0<$("#swlong").length){var a=new google.maps.LatLng($("#swlat").val(),$("#swlong").val()),b=new google.maps.LatLng($("#nelat").val(),$("#nelong").val());a=new google.maps.LatLngBounds(a,b);map.fitBounds(a)}};